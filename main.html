<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Currency Converter + REER + Flag Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
  .qr-section {
  margin-top: 16px;
  padding: 14px;
  border-radius: 14px;
  background: radial-gradient(circle at top, #1f2937 0, #020617 60%);
  text-align: center;
  border: 1px solid rgba(148, 163, 184, 0.5);
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.85);
}
.qr-title { font-size: 0.95rem; margin-bottom: 10px; color: #E5E7EB; font-weight: 600; }
.qr-note { font-size: 0.78rem; margin-top: 8px; color: #9CA3AF; }
#qrCodeBox canvas, #qrCodeBox img {
  margin: 0 auto;
  border-radius: 12px;
  padding: 8px;
  background: #ffffff;
}
@media (max-width: 768px) {
  .qr-section { display: none; }
}

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Poppins',sans-serif;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background:linear-gradient(135deg,#141E30 0%,#243B55 50%,#764ba2 100%);
      color:#111827;
    }
    .app{
      width:100%;
      max-width:980px;
      background:rgba(255,255,255,0.08);
      border-radius:28px;
      padding:24px 22px 22px;
      backdrop-filter:blur(24px);
      border:1px solid rgba(255,255,255,0.25);
      box-shadow:0 24px 50px rgba(0,0,0,0.45);
      color:#F9FAFB;
      position:relative;
      overflow:hidden;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
      gap:10px;
      flex-wrap:wrap;
    }
    .top-left-group{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .history-btn{
      width:34px;
      height:34px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      color:#E5E7EB;
      font-size:0.9rem;
      transition:.2s background,.2s transform,.2s box-shadow;
      box-shadow:0 8px 18px rgba(0,0,0,0.45);
    }
    .history-btn:hover{
      background:linear-gradient(135deg,#4F46E5,#EC4899);
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(79,70,229,0.6);
    }
    .top-title{
      font-size:1.5rem;
      font-weight:700;
      letter-spacing:0.03em;
    }
    .top-sub{
      font-size:0.8rem;
      color:#CBD5F5;
    }
    .pill{
      padding:4px 10px;
      border-radius:999px;
      background:rgba(15,23,42,0.8);
      font-size:0.68rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      border:1px solid rgba(148,163,184,0.4);
      white-space:nowrap;
    }

    .nav-main{
      display:flex;
      gap:8px;
      margin:4px 0 14px;
      flex-wrap:wrap;
    }
    .nav-main button{
      padding:7px 12px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.7);
      color:#E5E7EB;
      font-size:0.8rem;
      cursor:pointer;
      transition:.2s background,.2s color,.2s border;
    }
    .nav-main button.active{
      background:linear-gradient(135deg,#4F46E5,#EC4899);
      border-color:transparent;
      color:white;
    }

    .page{display:none;}
    .page.active{display:block;}

    .converter-layout{
      display:grid;
      grid-template-columns:minmax(0,1.05fr) minmax(0,1.1fr);
      gap:22px;
    }
    .converter-card{
      background:rgba(15,23,42,0.75);
      border-radius:20px;
      padding:16px 14px 14px;
      border:1px solid rgba(148,163,184,0.55);
    }
    .section-title{
      font-size:1.05rem;
      font-weight:600;
      margin-bottom:6px;
    }
    .section-sub{
      font-size:0.78rem;
      color:#CBD5F5;
      margin-bottom:10px;
    }

    .amount-group{margin-bottom:16px;}
    label{
      font-size:0.8rem;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:#9CA3AF;
      margin-bottom:6px;
      display:block;
    }
    .amount-input{
      width:100%;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.72);
      color:#F9FAFB;
      font-size:1.2rem;
      font-weight:600;
      outline:none;
      text-align:right;
      transition:.2s border,.2s box-shadow,.2s background;
    }
    .amount-input:focus{
      border-color:#60A5FA;
      box-shadow:0 0 0 1px rgba(96,165,250,0.3);
      background:rgba(15,23,42,0.95);
    }
    .curr-row{
      display:grid;
      grid-template-columns:1fr auto 1fr;
      gap:12px;
      margin-bottom:12px;
      align-items:center;
    }
    .select-wrap{position:relative;}
    select{
      width:100%;
      padding:10px 36px 10px 10px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.55);
      background:rgba(15,23,42,0.88);
      color:#E5E7EB;
      font-size:0.82rem;
      font-weight:500;
      appearance:none;
      outline:none;
      cursor:pointer;
      transition:.2s border,.2s box-shadow,.2s background;
    }
    select:focus{
      border-color:#A855F7;
      box-shadow:0 0 0 1px rgba(168,85,247,0.35);
      background:rgba(15,23,42,1);
    }
    .select-wrap::after{
      content:"‚ñæ";
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      font-size:0.7rem;
      color:#9CA3AF;
      pointer-events:none;
    }
    .flag-label{
      font-size:0.75rem;
      color:#9CA3AF;
      margin-top:2px;
      min-height:16px;
    }

    /* search above dropdowns */
    .search-wrap{
      position:relative;
      margin-bottom:6px;
    }
    .search-wrap input{
      width:100%;
      padding:7px 10px 7px 26px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      background:rgba(15,23,42,0.9);
      color:#E5E7EB;
      font-size:0.78rem;
      outline:none;
      transition:.2s border,.2s box-shadow,.2s background;
    }
    .search-wrap input:focus{
      border-color:#4F46E5;
      box-shadow:0 0 0 1px rgba(79,70,229,0.4);
      background:rgba(15,23,42,1);
    }
    .search-wrap .icon{
      position:absolute;
      left:8px;
      top:50%;
      transform:translateY(-50%);
      font-size:0.75rem;
      color:#9CA3AF;
      pointer-events:none;
    }

    .swap-btn{
      width:36px;
      height:36px;
      border-radius:999px;
      border:none;
      display:flex;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at 30% 0%,#FDE68A 0,#F97316 35%,#DB2777 70%,#6366F1 100%);
      color:white;
      cursor:pointer;
      box-shadow:0 10px 25px rgba(0,0,0,0.45);
      transition:.25s transform,.25s box-shadow;
      font-size:1rem;
    }
    .swap-btn:hover{
      transform:rotate(180deg) scale(1.05);
      box-shadow:0 14px 35px rgba(0,0,0,0.55);
    }
    .swap-btn:active{transform:scale(0.96)}
    .divider{
      height:1px;
      background:linear-gradient(90deg,transparent,#4B5563,transparent);
      margin:10px 0 12px;
    }
    .details-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.73rem;
      color:#9CA3AF;
      margin-bottom:10px;
    }
    .convert-btn{
      width:100%;
      padding:11px 14px;
      border-radius:16px;
      border:none;
      background:linear-gradient(135deg,#4F46E5,#EC4899);
      color:white;
      font-weight:600;
      font-size:0.9rem;
      cursor:pointer;
      box-shadow:0 12px 26px rgba(79,70,229,0.55);
      transition:.2s transform,.2s box-shadow,.2s filter;
    }
    .convert-btn:hover{
      transform:translateY(-1px);
      filter:brightness(1.05);
      box-shadow:0 16px 34px rgba(79,70,229,0.7);
    }
    .convert-btn:active{transform:translateY(0)}
    .result{
      margin-top:14px;
      padding:12px 12px 11px;
      border-radius:16px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.55);
      display:flex;
      flex-direction:column;
      gap:3px;
      opacity:0;
      transform:translateY(6px);
      transition:.25s opacity,.25s transform;
    }
    .result.show{
      opacity:1;
      transform:translateY(0);
    }
    .result-main{
      font-size:1rem;
      font-weight:600;
      color:#F9FAFB;
    }
    .result-sub{
      font-size:0.72rem;
      color:#9CA3AF;
    }
    .error{
      margin-top:8px;
      font-size:0.75rem;
      color:#FCA5A5;
      min-height:14px;
    }

    /* history panel */
    .history-panel{
      position:absolute;
      top:0;
      left:0;
      height:100%;
      width:260px;
      background:rgba(15,23,42,0.96);
      border-right:1px solid rgba(148,163,184,0.55);
      padding:14px 12px;
      transform:translateX(-100%);
      transition:.3s transform;
      z-index:20;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .history-panel.open{
      transform:translateX(0);
    }
    .history-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .history-title{
      font-size:0.95rem;
      font-weight:600;
    }
    .history-close{
      border:none;
      background:transparent;
      color:#9CA3AF;
      cursor:pointer;
      font-size:0.9rem;
    }
    .history-list{
      margin-top:8px;
      flex:1;
      overflow-y:auto;
      font-size:0.78rem;
      color:#E5E7EB;
    }
    .history-item{
      padding:6px 6px;
      border-radius:10px;
      border:1px solid rgba(55,65,81,0.9);
      margin-bottom:6px;
      background:rgba(17,24,39,0.9);
    }
    .history-meta{
      font-size:0.7rem;
      color:#9CA3AF;
      margin-top:2px;
    }
    .history-empty{
      font-size:0.76rem;
      color:#9CA3AF;
      margin-top:8px;
    }
    .history-footer{
      margin-top:6px;
      display:flex;
      justify-content:flex-end;
    }
    .clear-history{
      border:none;
      border-radius:999px;
      padding:5px 10px;
      font-size:0.72rem;
      cursor:pointer;
      background:rgba(31,41,55,0.9);
      color:#E5E7EB;
      border:1px solid rgba(75,85,99,0.9);
      transition:.2s background,.2s transform;
    }
    .clear-history:hover{
      background:rgba(55,65,81,1);
      transform:translateY(-1px);
    }

    /* REER page */
    .reer-layout{
      display:grid;
      grid-template-columns:minmax(0,1.05fr) minmax(0,1.2fr);
      gap:22px;
    }
    .reer-text,.reer-charts{
      background:rgba(15,23,42,0.75);
      border-radius:20px;
      padding:14px 14px 12px;
      border:1px solid rgba(148,163,184,0.55);
    }
    .reer-text p{
      font-size:0.8rem;
      color:#E5E7EB;
      margin-bottom:6px;
    }
    .reer-text ul{
      margin-left:14px;
      margin-top:4px;
      margin-bottom:6px;
      font-size:0.8rem;
      color:#E5E7EB;
    }
    .reer-text li{margin-bottom:3px;}
    .note-small{
      font-size:0.7rem;
      color:#9CA3AF;
      margin-top:4px;
    }

    .grid-reer{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
      gap:10px;
      margin-top:4px;
    }
    .reer-card{
      background:rgba(15,23,42,0.85);
      border-radius:16px;
      padding:8px 8px 6px;
      border:1px solid rgba(75,85,99,0.9);
    }
    .reer-card h3{
      font-size:0.85rem;
      margin-bottom:4px;
    }
    .reer-card canvas{
      width:100%;
      height:110px;
    }
    .reer-chip{
      font-size:0.7rem;
      color:#9CA3AF;
      margin-top:2px;
    }

    /* Flag Quiz page */
    .quiz-layout{
      display:grid;
      grid-template-columns:minmax(0,1.2fr) minmax(0,1fr);
      gap:22px;
    }
    .quiz-card{
      background:rgba(15,23,42,0.75);
      border-radius:20px;
      padding:16px 14px 14px;
      border:1px solid rgba(148,163,184,0.55);
    }
    .quiz-flag{
      font-size:3.2rem;
      text-align:center;
      margin:14px 0 10px;
    }
    .quiz-score{
      font-size:0.8rem;
      color:#CBD5F5;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .quiz-options{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .quiz-option{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.7);
      background:rgba(15,23,42,0.9);
      color:#E5E7EB;
      font-size:0.82rem;
      cursor:pointer;
      text-align:center;
      transition:.2s background,.2s border,.2s transform,.2s box-shadow;
    }
    .quiz-option:hover{
      background:rgba(31,41,55,1);
      transform:translateY(-1px);
      box-shadow:0 10px 20px rgba(0,0,0,0.45);
    }
    .quiz-option.correct{
      border-color:#22C55E;
      background:rgba(22,163,74,0.18);
    }
    .quiz-option.wrong{
      border-color:#EF4444;
      background:rgba(248,113,113,0.14);
    }
    .quiz-feedback{
      margin-top:10px;
      font-size:0.82rem;
      min-height:18px;
    }
    .quiz-feedback.correct{
      color:#6EE7B7;
    }
    .quiz-feedback.wrong{
      color:#FCA5A5;
    }
    .quiz-hint{
      font-size:0.76rem;
      color:#9CA3AF;
      margin-top:4px;
    }
    .quiz-side{
      background:rgba(15,23,42,0.75);
      border-radius:20px;
      padding:16px 14px 14px;
      border:1px solid rgba(148,163,184,0.55);
      font-size:0.8rem;
      color:#E5E7EB;
    }
    .quiz-side ul{
      margin-left:14px;
      margin-top:4px;
    }
    .quiz-side li{
      margin-bottom:4px;
    }

    /* quiz progress indicator */
    .quiz-progress-row{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:0.78rem;
      color:#CBD5F5;
    }
    .quiz-progress-bar{
      width:100%;
      height:6px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      overflow:hidden;
      border:1px solid rgba(148,163,184,0.6);
    }
    .quiz-progress-bar #quizProgressFill{
      height:100%;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#4F46E5,#EC4899);
      transition:width .25s ease-out;
    }

    @media(max-width:880px){
      .converter-layout,.reer-layout,.quiz-layout{
        grid-template-columns:1fr;
      }
    }
    @media(max-width:620px){
      .app{padding:20px 14px 16px;border-radius:24px}
      .top-title{font-size:1.3rem}
      .curr-row{grid-template-columns:1fr;gap:10px}
      .swap-btn{margin:2px auto}
      .quiz-options{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
<div class="app">
  <!-- history slide-in -->
  <div class="history-panel" id="historyPanel">
    <div class="history-header">
      <div class="history-title">Recent conversions</div>
      <button class="history-close" id="historyClose">‚úï</button>
    </div>
    <div class="history-list" id="historyList"></div>
    <div class="history-empty" id="historyEmpty">No history yet. Convert some amounts to see them here.</div>
    <div class="history-footer">
      <button class="clear-history" id="clearHistoryBtn">Clear history</button>
    </div>
  </div>

  <div class="topbar">
    <div class="top-left-group">
      <button class="history-btn" id="historyBtn" title="Show recent conversions">‚ò∞</button>
      <div>
        <div class="top-title">Currency Converter & REER Explorer</div>
        <div class="top-sub"> Designed and Created by CSE-05's The Learners Team</div>
      </div>
    </div>
    <div class="pill">Offline converter ¬∑ REER indices ¬∑ Flag quiz</div>
  </div>

  <div class="nav-main">
    <button class="active" data-page="page1">Page 1 ‚Äì Converter</button>
    <button data-page="page2">Page 2 ‚Äì REER Graphs</button>
    <button data-page="page3">Page 3 ‚Äì Flag Quiz</button>
       <button data-page="page4">Page 4 ‚Äì Budget Planner</button>
  </div>

  <!-- PAGE 1: CONVERTER -->
  <div id="page1" class="page active">
    <div class="converter-layout">
      <div class="converter-card">
        <div class="section-title">üí± CURRENCY CONVERTER</div>
        <div class="section-sub">Application Programming Interface based.</div>

        <div class="amount-group">
          <label for="amount">Amount</label>
          <input id="amount" type="number" class="amount-input" value="100" min="0" step="0.01" />
        </div>

        <div class="curr-row">
          <div>
            <label for="fromCurrency">From</label>
            <div class="search-wrap">
              <span class="icon">üîç</span>
              <input type="text" id="fromSearch" placeholder="Search currency..." />
            </div>
            <div class="select-wrap">
              <select id="fromCurrency"></select>
            </div>
            <div class="flag-label" id="fromLabel"></div>
          </div>

          <button class="swap-btn" id="swapBtn" title="Swap currencies">‚áÑ</button>

          <div>
            <label for="toCurrency">To</label>
            <div class="search-wrap">
              <span class="icon">üîç</span>
              <input type="text" id="toSearch" placeholder="Search currency..." />
            </div>
            <div class="select-wrap">
              <select id="toCurrency"></select>
            </div>
            <div class="flag-label" id="toLabel"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="details-row">
          <span id="rateInfo">Rate: ‚Äì</span>
          <span id="pairInfo">Pair: ‚Äì</span>
        </div>

        <button class="convert-btn" id="convertBtn">Convert</button>

        <div class="result" id="resultBox">
          <div class="result-main" id="resultMain"></div>
          <div class="result-sub" id="resultSub"></div>
        </div>

        <div class="error" id="errorBox"></div>
      </div>
      <div id="qrSection" class="qr-section">
  <div class="qr-title">Open this converter on your phone for better version of this website</div>
  <div id="qrCodeBox"></div>
  <div class="qr-note">Scan with your mobile camera to open this same page.</div>
</div>
      <div class="converter-card">
        <div class="section-title">‚ÑπÔ∏è How this converter works</div>
        <div class="section-sub">Internal logic mirrors your C program: amount is converted to a USD‚Äëbased value, then into the target currency using fixed ratios.</div>
        <p style="font-size:0.8rem;color:#E5E7EB;margin-bottom:6px;">
          Steps:
        </p>
        <ul style="margin-left:14px;font-size:0.8rem;color:#E5E7EB;">
          <li>Our currency converter is designed to deliver accurate and reliable exchange rate conversions by primarily relying on the Fawaz Currency API. When a user selects two currencies and enters an amount, the converter sends a request to this API, which provides real-time or near‚Äìreal-time exchange rate data. This ensures that the converted value reflects the latest market conditions, making the tool suitable for everyday financial reference and learning purposes.</li>
          <li>Behind the scenes, the application processes the API response, extracts the required exchange rate, and performs the conversion instantly on the client side. The interface then formats and displays the result clearly for the user. This API-first approach allows your currency converter to stay dynamic and scalable, as any updates in global exchange rates are automatically reflected without needing frequent manual updates to the code.</li>
          <li>To maintain reliability, your currency converter also includes a fallback mechanism. If the Fawaz Currency API fails to respond, returns an error, or is temporarily unavailable, the system automatically switches to a set of manually stored exchange rate values. This ensures that the converter continues to function without interruption, providing users with reasonable and consistent conversion results even during API downtime.</li>
        </ul>
        <p class="note-small">
          For live FX, actual APIs or central‚Äëbank data are needed, but this project focuses on algorithm and interface using static reference values.
        </p>
      </div>
    </div>
  </div>

  <!-- PAGE 2: REER EXPLANATION + GRAPHS -->
  <div id="page2" class="page">
    <div class="reer-layout">
      <div class="reer-text">
        <div class="section-title">üìà What is REER?</div>
        <p>
          REER (Real Effective Exchange Rate) is an index that measures the value of a country‚Äôs currency against a basket of trading‚Äëpartner currencies, adjusted for inflation differences.
        </p>
        <p>
          It starts from the NEER (Nominal Effective Exchange Rate), which is a trade‚Äëweighted average of bilateral exchange rates, and then adjusts by relative price levels between the home country and its partners.
        </p>
        <p>In simple terms:</p>
        <ul>
          <li>Basket: Main trading partners‚Äô currencies, with weights based on trade shares.</li>
          <li>Nominal index: Weighted average of exchange rates (NEER index, usually with a base year like 2010 = 100).</li>
          <li>Real adjustment: NEER is divided or scaled by relative price indices (inflation) to get REER.</li>
        </ul>
        <p>Interpreting the REER index:</p>
        <ul>
          <li>Value above 100 (relative to base year) usually means real appreciation and possible loss of price competitiveness.</li>
          <li>Value below 100 indicates real depreciation and potentially better export competitiveness, but more expensive imports.</li>
          <li>Changes over time show whether a currency has become stronger or weaker in real, trade‚Äëweighted terms, instead of just against one other currency.</li>
        </ul>
        <p>How to use REER to see currency growth:</p>
        <ul>
          <li>Upward‚Äësloping REER line ‚áí real appreciation (currency has gained value versus partners after inflation).</li>
          <li>Downward‚Äësloping REER line ‚áí real depreciation (currency cheaper than before in real terms).</li>
          <li>Stable REER around 100 ‚áí currency broadly in line with its base‚Äëyear competitiveness.</li>
        </ul>
        <p class="note-small">
          The values below are sample REER‚Äëstyle indices you provided (base ‚âà 2010 = 100), used here for illustration of appreciation or depreciation trends across USD, INR, JPY, CNY, HKD, SGD, GBP, CHF, AUD, and CAD.
        </p>
      </div>

      <div class="reer-charts">
        <div class="section-title">üìä REER Graphs (2015‚Äì2025)</div>
        <div class="section-sub">
          Each mini chart shows the REER index over 2015‚Äì2025 for 10 currencies. A rising line suggests real appreciation; a falling line suggests real depreciation relative to the base year.
        </div>

        <div class="grid-reer">
          <div class="reer-card">
            <h3>üá∫üá∏ USD ‚Äì REER</h3>
            <canvas id="reer-USD"></canvas>
            <div class="reer-chip">Index (2010 ‚âà 100): mostly above 100, showing a strong dollar vs trading partners.</div>
          </div>

          <div class="reer-card">
            <h3>üáÆüá≥ INR ‚Äì REER</h3>
            <canvas id="reer-INR"></canvas>
            <div class="reer-chip">Index gradually rising above 100, indicating phases of appreciation and stronger rupee in real terms.</div>
          </div>

          <div class="reer-card">
            <h3>üáØüáµ JPY ‚Äì REER</h3>
            <canvas id="reer-JPY"></canvas>
            <div class="reer-chip">Index drifting below 100, consistent with real depreciation of the yen over this period.</div>
          </div>

          <div class="reer-card">
            <h3>üá®üá≥ CNY ‚Äì REER</h3>
            <canvas id="reer-CNY"></canvas>
            <div class="reer-chip">Index above 100 for most years, reflecting stronger renminbi in real, trade‚Äëweighted terms.</div>
          </div>

          <div class="reer-card">
            <h3>üá≠üá∞ HKD ‚Äì REER</h3>
            <canvas id="reer-HKD"></canvas>
            <div class="reer-chip">Index close to 100, consistent with a very stable, USD‚Äëlinked currency.</div>
          </div>

          <div class="reer-card">
            <h3>üá∏üá¨ SGD ‚Äì REER</h3>
            <canvas id="reer-SGD"></canvas>
            <div class="reer-chip">Index trending upward, showing gradual appreciation of the Singapore dollar in real terms.</div>
          </div>

          <div class="reer-card">
            <h3>üá¨üáß GBP ‚Äì REER</h3>
            <canvas id="reer-GBP"></canvas>
            <div class="reer-chip">Index dips after 2015, then stabilises, matching post‚ÄëBrexit adjustment and later recovery.</div>
          </div>

          <div class="reer-card">
            <h3>üá®üá≠ CHF ‚Äì REER</h3>
            <canvas id="reer-CHF"></canvas>
            <div class="reer-chip">Index well above 100 and rising, consistent with a strong, safe‚Äëhaven Swiss franc.</div>
          </div>

          <div class="reer-card">
            <h3>üá¶üá∫ AUD ‚Äì REER</h3>
            <canvas id="reer-AUD"></canvas>
            <div class="reer-chip">Index moves slightly below and around 100, reflecting moderate swings in external competitiveness.</div>
          </div>

          <div class="reer-card">
            <h3>üá®üá¶ CAD ‚Äì REER</h3>
            <canvas id="reer-CAD"></canvas>
            <div class="reer-chip">Index near 100 with mild appreciation after 2020, in line with changing oil and trade conditions.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGE 3: FLAG QUIZ -->
  <div id="page3" class="page">
    <div class="quiz-layout">
      <div class="quiz-card">
        <div class="section-title">üè≥Ô∏è‚Äçüåà Flag Quiz</div>
        <div class="section-sub">Guess the correct country for each flag. 10 questions per game.</div>

        <div class="quiz-score">
          <span id="quizScore">Score: 0 / 10</span>
          <span id="quizStreak">Current streak: 0</span>
        </div>

        <div class="quiz-progress-row">
          <span id="quizQuestionText">Question 1 of 10</span>
          <div class="quiz-progress-bar">
            <div id="quizProgressFill"></div>
          </div>
        </div>

        <div class="quiz-flag" id="quizFlag">üá∫üá≥</div>

        <div class="quiz-options" id="quizOptions"></div>

        <div class="quiz-feedback" id="quizFeedback"></div>
        <div class="quiz-hint">You get 10 questions. After that you‚Äôll see your final score and can play again.</div>
      </div>

      <div class="quiz-side">
        <div class="section-title">üéØ How this game works</div>
        <p>Flags and country names come from the same 108‚Äëcurrency list used by your converter, so everything stays consistent.</p>
        <ul>
          <li>Each game has exactly 10 random flags.</li>
          <li>You get four country name options: one correct and three random wrong ones.</li>
          <li>Options are shuffled so the correct one appears in different positions.</li>
          <li>At the end you see ‚ÄúYou got X out of 10‚Äù and a Play Again button.</li>
        </ul>
        <p class="note-small">Nice extra page for practice and fun inside the same project.</p>
      </div>
    </div>
  </div>
  <!-- PAGE 4: BUDGET PLANNER -->
<div id="page4" class="page">
  <div class="quiz-layout" style="grid-template-columns:minmax(0,1.1fr) minmax(0,0.9fr);">
    <!-- LEFT: main planner -->
    <div class="quiz-card">
      <div class="section-title">üß≥ Trip Budget Planner</div>
      <div class="section-sub">
        Plan your total trip cost and see a per‚Äëday budget in your destination currency.
      </div>

      <!-- Trip basics -->
      <div class="amount-group">
        <label for="bpTripName">Trip name</label>
        <input id="bpTripName" type="text" class="amount-input"
               placeholder="e.g., Goa with friends, Singapore family trip" style="text-align:left;font-size:0.85rem;">
      </div>

      <div class="curr-row">
        <div>
          <label>Home currency</label>
          <div class="select-wrap">
            <select id="bpFrom"></select>
          </div>
        </div>
        <div></div>
        <div>
          <label>Destination currency</label>
          <div class="select-wrap">
            <select id="bpTo"></select>
          </div>
        </div>
      </div>

      <div class="amount-group" style="margin-top:10px;">
        <label for="bpTotal">Total budget (home currency)</label>
        <input id="bpTotal" type="number" class="amount-input" value="50000" min="0" step="0.01" />
      </div>

      <div class="amount-group">
        <label for="bpDays">Trip length (days)</label>
        <input id="bpDays" type="number" class="amount-input" value="5" min="1" step="1" />
      </div>

      <!-- Category sliders -->
      <div class="divider"></div>
      <div class="section-sub" style="margin-bottom:4px;">Split your budget by category (percentages)</div>

      <div style="font-size:0.78rem;color:#E5E7EB;display:flex;flex-direction:column;gap:8px;">
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span>Stay (hotel)</span><span id="bpStayPctLabel">40%</span>
          </div>
          <input type="range" id="bpStayPct" min="0" max="100" value="40" />
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span>Food</span><span id="bpFoodPctLabel">30%</span>
          </div>
          <input type="range" id="bpFoodPct" min="0" max="100" value="30" />
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span>Transport</span><span id="bpTravelPctLabel">20%</span>
          </div>
          <input type="range" id="bpTravelPct" min="0" max="100" value="20" />
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span>Fun / Shopping</span><span id="bpFunPctLabel">10%</span>
          </div>
          <input type="range" id="bpFunPct" min="0" max="100" value="10" />
        </div>
        <div class="note-small" id="bpPctNote">
          Total: 100%. Drag sliders to change the mix (the planner will auto‚Äënormalize if needed).
        </div>
      </div>

      <button class="convert-btn" id="bpCalcBtn" style="margin-top:10px;">Calculate budget</button>

      <div class="result" id="bpResultBox">
        <div class="result-main" id="bpResultMain"></div>
        <div class="result-sub" id="bpResultSub"></div>
      </div>

      <div class="error" id="bpErrorBox"></div>
    </div>

    <!-- RIGHT: visual summary -->
    <div class="quiz-side" style="display:flex;flex-direction:column;gap:10px;">
      <div>
        <div class="section-title">üìä Trip summary</div>
        <p id="bpSummaryLine" style="font-size:0.8rem;color:#E5E7EB;">
          Enter trip details to see your summary here.
        </p>
      </div>

      <div>
        <div class="section-title">üçΩ Category breakdown</div>
        <p class="note-small">Approximate amounts per category in destination currency.</p>

        <div style="margin-top:6px;display:flex;flex-direction:column;gap:6px;font-size:0.8rem;color:#E5E7EB;" id="bpBreakdownList">
          <!-- Filled by JS -->
        </div>
      </div>

      <div>
        <div class="section-title">üí° Tip</div>
        <p class="note-small">
          Aim for a daily buffer of at least 10‚Äì15% above your planned per‚Äëday budget to handle surprises like local transport or snacks. [web:184][web:189]
        </p>
      </div>
    </div>
  </div>
</div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script> <!-- QRCode.js [web:159][web:148] -->


<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // === PAGE SWITCHER ===
  document.querySelectorAll('.nav-main button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.nav-main button').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(btn.dataset.page).classList.add('active');
    });
  });

  // === CURRENCY LIST + STATIC RATES (fallback) ===
  const codes = [
    "USD","EUR","JPY","GBP","AUD","CAD","CHF","CNY","HKD","NZD",
    "SEK","KRW","SGD","NOK","MXN","INR","RUB","ZAR","TRY","BRL",
    "TWD","DKK","PLN","THB","IDR","HUF","CZK","ILS","CLP","PHP",
    "AED","COP","SAR","MYR","RON","PKR","QAR","KWD","NGN","BDT",
    "EGP","VND","KZT","ARS","DZD","MAD","PEN","UAH","IQD","UZS",
    "GHS","XOF","XAF","KES","TND","BHD","OMR","LKR","MMK","ETB",
    "BGN","HRK","CRC","GTQ","PAB","UYU","BWP","NAD",
    "BND","SRD","BZD","JMD","TTD","BSD","ALL","MKD","GEL","MDL",
    "AZN","AMD","KYD","MUR","MGA","MWK","ZMW","BBD","SCR","NPR",
    "KGS","LAK","KHR","YER","AFN","IRR","SDG",
    "LYD","CDF","BIF","RWF","DJF","SLL","GNF","MZN","SZL",
    "LSL","PGK","FJD","TOP","WST","VUV","HTG","HNL","NIO","BOB",
    "PYG","GYD","SOS","BTN","TJS","ISK","FKP","SHP",
    "GIP","ANG","AWG","ERN"
  ];

  const rates = [
    1.0000,0.8518,155.8,0.7478,1.503,1.377,0.8042,7.055,7.785,1.723,
    9.270,1475,1.292,10.13,18.02,90.58,79.67,16.88,42.70,5.419,
    31.36,6.362,3.597,31.60,16636.50,328.1,20.68,3.219,910.3,59.10,
    3.673,3806,3.752,4.101,4.337,280.3,3.645,0.3067,1482.56,122.2,
    47.54,26310,521.23,1441,129.55,9.197,3.368,42.03,1307.90,1311.2258,12072.70,
    11.48,558.7,558.48,129,2.918,0.377,0.3850,309,2099.7,155.04,
    1.666,6.418,497.3,7.652,1.0000,39.19,14.11,16.88,
    1.29,38.55,2.0000,159.51,6.763,1.0000,82.19,52.50,2.695,16.83,
    1.700,381.0,0.82,45.91,4477,1733.67,23.10,2.0000,14.81,144.7,
    87.36,21679.30,4006.75,238.50,66.07,42122.50,601.50,
    5.42,2288.68,2951,1453,178.1,23161.40,8680,63.88,16.87,
    16.87,4.245,2.274,2.382,2.756,121.4,130.99,26.27,36.82,6.885,
    6388,209.22,569.58,90.50,9.229,126.40,0.7478,0.7485,0.7478,1.790,1.790,15
  ];

  const metaArr = [
    {code:"USD", country:"United States", flag:"üá∫üá∏"},
    {code:"EUR", country:"European Union", flag:"üá™üá∫"},
    {code:"JPY", country:"Japan", flag:"üáØüáµ"},
    {code:"GBP", country:"United Kingdom", flag:"üá¨üáß"},
    {code:"AUD", country:"Australia", flag:"üá¶üá∫"},
    {code:"CAD", country:"Canada", flag:"üá®üá¶"},
    {code:"CHF", country:"Switzerland", flag:"üá®üá≠"},
    {code:"CNY", country:"China", flag:"üá®üá≥"},
    {code:"HKD", country:"Hong Kong", flag:"üá≠üá∞"},
    {code:"NZD", country:"New Zealand", flag:"üá≥üáø"},
    {code:"SEK", country:"Sweden", flag:"üá∏üá™"},
    {code:"KRW", country:"South Korea", flag:"üá∞üá∑"},
    {code:"SGD", country:"Singapore", flag:"üá∏üá¨"},
    {code:"NOK", country:"Norway", flag:"üá≥üá¥"},
    {code:"MXN", country:"Mexico", flag:"üá≤üáΩ"},
    {code:"INR", country:"India", flag:"üáÆüá≥"},
    {code:"RUB", country:"Russia", flag:"üá∑üá∫"},
    {code:"ZAR", country:"South Africa", flag:"üáøüá¶"},
    {code:"TRY", country:"Turkey", flag:"üáπüá∑"},
    {code:"BRL", country:"Brazil", flag:"üáßüá∑"},
    {code:"TWD", country:"Taiwan", flag:"üáπüáº"},
    {code:"DKK", country:"Denmark", flag:"üá©üá∞"},
    {code:"PLN", country:"Poland", flag:"üáµüá±"},
    {code:"THB", country:"Thailand", flag:"üáπüá≠"},
    {code:"IDR", country:"Indonesia", flag:"üáÆüá©"},
    {code:"HUF", country:"Hungary", flag:"üá≠üá∫"},
    {code:"CZK", country:"Czech Republic", flag:"üá®üáø"},
    {code:"ILS", country:"Israel", flag:"üáÆüá±"},
    {code:"CLP", country:"Chile", flag:"üá®üá±"},
    {code:"PHP", country:"Philippines", flag:"üáµüá≠"},
    {code:"AED", country:"UAE", flag:"üá¶üá™"},
    {code:"COP", country:"Colombia", flag:"üá®üá¥"},
    {code:"SAR", country:"Saudi Arabia", flag:"üá∏üá¶"},
    {code:"MYR", country:"Malaysia", flag:"üá≤üáæ"},
    {code:"RON", country:"Romania", flag:"üá∑üá¥"},
    {code:"PKR", country:"Pakistan", flag:"üáµüá∞"},
    {code:"QAR", country:"Qatar", flag:"üá∂üá¶"},
    {code:"KWD", country:"Kuwait", flag:"üá∞üáº"},
    {code:"NGN", country:"Nigeria", flag:"üá≥üá¨"},
    {code:"BDT", country:"Bangladesh", flag:"üáßüá©"},
    {code:"EGP", country:"Egypt", flag:"üá™üá¨"},
    {code:"VND", country:"Vietnam", flag:"üáªüá≥"},
    {code:"KZT", country:"Kazakhstan", flag:"üá∞üáø"},
    {code:"ARS", country:"Argentina", flag:"üá¶üá∑"},
    {code:"DZD", country:"Algeria", flag:"üá©üáø"},
    {code:"MAD", country:"Morocco", flag:"üá≤üá¶"},
    {code:"PEN", country:"Peru", flag:"üáµüá™"},
    {code:"UAH", country:"Ukraine", flag:"üá∫üá¶"},
    {code:"IQD", country:"Iraq", flag:"üáÆüá∂"},
    {code:"UZS", country:"Uzbekistan", flag:"üá∫üáø"},
    {code:"GHS", country:"Ghana", flag:"üá¨üá≠"},
    {code:"XOF", country:"West Africa", flag:"üåç"},
    {code:"XAF", country:"Central Africa", flag:"üåç"},
    {code:"KES", country:"Kenya", flag:"üá∞üá™"},
    {code:"TND", country:"Tunisia", flag:"üáπüá≥"},
    {code:"BHD", country:"Bahrain", flag:"üáßüá≠"},
    {code:"OMR", country:"Oman", flag:"üá¥üá≤"},
    {code:"LKR", country:"Sri Lanka", flag:"üá±üá∞"},
    {code:"MMK", country:"Myanmar", flag:"üá≤üá≤"},
    {code:"ETB", country:"Ethiopia", flag:"üá™üáπ"},
    {code:"BGN", country:"Bulgaria", flag:"üáßüá¨"},
    {code:"HRK", country:"Croatia", flag:"üá≠üá∑"},
    {code:"CRC", country:"Costa Rica", flag:"üá®üá∑"},
    {code:"GTQ", country:"Guatemala", flag:"üá¨üáπ"},
    {code:"PAB", country:"Panama", flag:"üáµüá¶"},
    {code:"UYU", country:"Uruguay", flag:"üá∫üáæ"},
    {code:"BWP", country:"Botswana", flag:"üáßüáº"},
    {code:"NAD", country:"Namibia", flag:"üá≥üá¶"},
    {code:"BND", country:"Brunei", flag:"üáßüá≥"},
    {code:"SRD", country:"Suriname", flag:"üá∏üá∑"},
    {code:"BZD", country:"Belize", flag:"üáßüáø"},
    {code:"JMD", country:"Jamaica", flag:"üáØüá≤"},
    {code:"TTD", country:"Trinidad & Tobago", flag:"üáπüáπ"},
    {code:"BSD", country:"Bahamas", flag:"üáßüá∏"},
    {code:"ALL", country:"Albania", flag:"üá¶üá±"},
    {code:"MKD", country:"North Macedonia", flag:"üá≤üá∞"},
    {code:"GEL", country:"Georgia", flag:"üá¨üá™"},
    {code:"MDL", country:"Moldova", flag:"üá≤üá©"},
    {code:"AZN", country:"Azerbaijan", flag:"üá¶üáø"},
    {code:"AMD", country:"Armenia", flag:"üá¶üá≤"},
    {code:"KYD", country:"Cayman Islands", flag:"üá∞üáæ"},
    {code:"MUR", country:"Mauritius", flag:"üá≤üá∫"},
    {code:"MGA", country:"Madagascar", flag:"üá≤üá¨"},
    {code:"MWK", country:"Malawi", flag:"üá≤üáº"},
    {code:"ZMW", country:"Zambia", flag:"üáøüá≤"},
    {code:"BBD", country:"Barbados", flag:"üáßüáß"},
    {code:"SCR", country:"Seychelles", flag:"üá∏üá®"},
    {code:"NPR", country:"Nepal", flag:"üá≥üáµ"},
    {code:"KGS", country:"Kyrgyzstan", flag:"üá∞üá¨"},
    {code:"LAK", country:"Laos", flag:"üá±üá¶"},
    {code:"KHR", country:"Cambodia", flag:"üá∞üá≠"},
    {code:"YER", country:"Yemen", flag:"üáæüá™"},
    {code:"AFN", country:"Afghanistan", flag:"üá¶üá´"},
    {code:"IRR", country:"Iran", flag:"üáÆüá∑"},
    {code:"SDG", country:"Sudan", flag:"üá∏üá©"},
    {code:"LYD", country:"Libya", flag:"üá±üáæ"},
    {code:"CDF", country:"DR Congo", flag:"üá®üá©"},
    {code:"BIF", country:"Burundi", flag:"üáßüáÆ"},
    {code:"RWF", country:"Rwanda", flag:"üá∑üáº"},
    {code:"DJF", country:"Djibouti", flag:"üá©üáØ"},
    {code:"SLL", country:"Sierra Leone", flag:"üá∏üá±"},
    {code:"GNF", country:"Guinea", flag:"üá¨üá≥"},
    {code:"MZN", country:"Mozambique", flag:"üá≤üáø"},
    {code:"SZL", country:"Eswatini", flag:"üá∏üáø"},
    {code:"LSL", country:"Lesotho", flag:"üá±üá∏"},
    {code:"PGK", country:"Papua New Guinea", flag:"üáµüá¨"},
    {code:"FJD", country:"Fiji", flag:"üá´üáØ"},
    {code:"TOP", country:"Tonga", flag:"üáπüá¥"},
    {code:"WST", country:"Samoa", flag:"üáºüá∏"},
    {code:"VUV", country:"Vanuatu", flag:"üáªüá∫"},
    {code:"HTG", country:"Haiti", flag:"üá≠üáπ"},
    {code:"HNL", country:"Honduras", flag:"üá≠üá≥"},
    {code:"NIO", country:"Nicaragua", flag:"üá≥üáÆ"},
    {code:"BOB", country:"Bolivia", flag:"üáßüá¥"},
    {code:"PYG", country:"Paraguay", flag:"üáµüáæ"},
    {code:"GYD", country:"Guyana", flag:"üá¨üáæ"},
    {code:"SOS", country:"Somalia", flag:"üá∏üá¥"},
    {code:"BTN", country:"Bhutan", flag:"üáßüáπ"},
    {code:"TJS", country:"Tajikistan", flag:"üáπüáØ"},
    {code:"ISK", country:"Iceland", flag:"üáÆüá∏"},
    {code:"FKP", country:"Falkland Islands", flag:"üá´üá∞"},
    {code:"SHP", country:"Saint Helena", flag:"üá∏üá≠"},
    {code:"GIP", country:"Gibraltar", flag:"üá¨üáÆ"},
    {code:"ANG", country:"Cura√ßao", flag:"üá®üáº"},
    {code:"AWG", country:"Aruba", flag:"üá¶üáº"},
    {code:"ERN", country:"Eritrea", flag:"üá™üá∑"}
  ];

  const meta = {};
  metaArr.forEach(m => meta[m.code] = m);
  function labelFor(code){
    const m = meta[code];
    return m ? `${m.flag}  ${code} ‚Äî ${m.country}` : code;
  }

  // === Converter DOM ===
  const fromSel = document.getElementById('fromCurrency');
  const toSel = document.getElementById('toCurrency');
  const fromLabel = document.getElementById('fromLabel');
  const toLabel = document.getElementById('toLabel');
  const amountInput = document.getElementById('amount');
  const convertBtn = document.getElementById('convertBtn');
  const swapBtn = document.getElementById('swapBtn');
  const resultBox = document.getElementById('resultBox');
  const resultMain = document.getElementById('resultMain');
  const resultSub = document.getElementById('resultSub');
  const errorBox = document.getElementById('errorBox');
  const rateInfo = document.getElementById('rateInfo');
  const pairInfo = document.getElementById('pairInfo');

  const fromSearch = document.getElementById('fromSearch');
  const toSearch = document.getElementById('toSearch');

  const historyPanel = document.getElementById('historyPanel');
  const historyBtn = document.getElementById('historyBtn');
  const historyClose = document.getElementById('historyClose');
  const historyList = document.getElementById('historyList');
  const historyEmpty = document.getElementById('historyEmpty');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  const HISTORY_KEY = 'fx_history_v1_fawaz_plus_fallback';

  // === Populate selects + search ===
  function populateSelect(selectEl, searchTerm){
    const term = (searchTerm || '').toLowerCase();
    selectEl.innerHTML = '';
    codes.forEach(code=>{
      const label = labelFor(code);
      if (!term || label.toLowerCase().includes(term)) {
        const o = document.createElement('option');
        o.value = code;
        o.textContent = label;
        selectEl.appendChild(o);
      }
    });
  }

  function syncIfMissing(selectEl, fallbackCode){
    if(!Array.from(selectEl.options).some(o=>o.value===selectEl.value)){
      if(Array.from(selectEl.options).some(o=>o.value===fallbackCode)){
        selectEl.value = fallbackCode;
      } else if(selectEl.options.length>0){
        selectEl.selectedIndex = 0;
      }
    }
  }

  populateSelect(fromSel,'');
  populateSelect(toSel,'');
  fromSel.value = 'USD';
  toSel.value = 'INR';

  function updateMiniLabels(){
    fromLabel.textContent = labelFor(fromSel.value);
    toLabel.textContent = labelFor(toSel.value);
  }
  updateMiniLabels();

  fromSearch.addEventListener('input',()=>{
    const current = fromSel.value;
    populateSelect(fromSel, fromSearch.value);
    syncIfMissing(fromSel, current || 'USD');
    updateMiniLabels();
  });
  toSearch.addEventListener('input',()=>{
    const current = toSel.value;
    populateSelect(toSel, toSearch.value);
    syncIfMissing(toSel, current || 'INR');
    updateMiniLabels();
  });

  // === History ===
  function formatNumber(num){
    return Number(num).toLocaleString(undefined,{maximumFractionDigits:2});
  }

  function saveToHistory(entry){
    let list = [];
    try{
      const raw = localStorage.getItem(HISTORY_KEY);
      if(raw) list = JSON.parse(raw);
    }catch(e){}
    list.unshift(entry);
    if(list.length>20) list = list.slice(0,20);
    localStorage.setItem(HISTORY_KEY, JSON.stringify(list));
    renderHistory();
  }

  function renderHistory(){
    let list=[];
    try{
      const raw = localStorage.getItem(HISTORY_KEY);
      if(raw) list = JSON.parse(raw);
    }catch(e){}
    historyList.innerHTML='';
    if(!list.length){
      historyEmpty.style.display='block';
      return;
    }
    historyEmpty.style.display='none';
    list.forEach(item=>{
      const div=document.createElement('div');
      div.className='history-item';
      div.innerHTML = `
        <div>${item.text}</div>
        <div class="history-meta">${item.meta}</div>
      `;
      historyList.appendChild(div);
    });
  }

  historyBtn.addEventListener('click',()=>{
    renderHistory();
    historyPanel.classList.add('open');
  });
  historyClose.addEventListener('click',()=>{
    historyPanel.classList.remove('open');
  });
  clearHistoryBtn.addEventListener('click',()=>{
    localStorage.removeItem(HISTORY_KEY);
    renderHistory();
  });
  renderHistory();

  // === Fawaz API helper + manual fallback ===
  // Free currency API via jsDelivr + pages.dev, daily updates. [web:102][web:14]
  async function getRateFawazWithFallback(fromCode, toCode){
    const from = fromCode.toLowerCase();
    const to = toCode.toLowerCase();

    const primary = `https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/${from}.json`;
    const backup  = `https://currency-api.pages.dev/latest/v1/currencies/${from}.json`;

    async function fetchJson(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    }

    try{
      let data;
      try{
        data = await fetchJson(primary);
      } catch {
        data = await fetchJson(backup);
      }
      if (data[from] && typeof data[from][to] === 'number') {
        return { rate: data[from][to], source: 'live' };
      }
      throw new Error('No rate in Fawaz data');
    } catch(e){
      console.warn('Fawaz API failed, falling back to manual rates[]:', e);
    }

    const iFrom = codes.indexOf(fromCode.toUpperCase());
    const iTo   = codes.indexOf(toCode.toUpperCase());
    if (iFrom === -1 || iTo === -1) {
      throw new Error('No manual fallback for this currency code');
    }
    const fallbackRate = rates[iTo] / rates[iFrom];
    return { rate: fallbackRate, source: 'offline' };
  }

  // === Converter (big main result + explicit 1 XXX = Y YYY line) ===
  async function convert(){
    errorBox.textContent = '';
    const amount = parseFloat(amountInput.value);

    if (isNaN(amount) || amount <= 0) {
      errorBox.textContent = 'Please enter a valid amount greater than zero.';
      resultBox.classList.remove('show');
      return;
    }

    const fromCode = fromSel.value;
    const toCode = toSel.value;

    try {
      const { rate, source } = await getRateFawazWithFallback(fromCode, toCode);
      const finalValue = amount * rate;

      const sourceText = source === 'live'
        ? 'Live daily rate (Fawaz currency API)'
        : 'Offline static rate (manual table)';

      const pairLine = `1 ${fromCode} = ${rate.toFixed(4)} ${toCode}`;

      resultMain.textContent =
        `${formatNumber(amount)} ${fromCode} = ${formatNumber(finalValue.toFixed(2))} ${toCode}`;
      resultMain.style.fontSize = '2.2rem';
      resultMain.style.fontWeight = '700';

      resultSub.textContent = `${pairLine} ¬∑ ${sourceText}`;

      resultBox.classList.add('show');
      rateInfo.textContent = pairLine;
      pairInfo.textContent = `Pair: ${fromCode}/${toCode}`;

      const now = new Date();
      const stamp = now.toLocaleString();
      const entry = {
        text: `${formatNumber(amount)} ${fromCode} ‚Üí ${formatNumber(finalValue.toFixed(2))} ${toCode}`,
        meta: `${fromCode}/${toCode} ¬∑ ${pairLine} ¬∑ ${sourceText} ¬∑ ${stamp}`
      };
      saveToHistory(entry);
    } catch (err) {
      console.error(err);
      resultBox.classList.remove('show');
      errorBox.textContent = 'Could not get any rate (live or manual) for this pair.';
    }
  }

  convertBtn.addEventListener('click', convert);
  swapBtn.addEventListener('click',()=>{
    const tmp = fromSel.value;
    fromSel.value = toSel.value;
    toSel.value = tmp;
    updateMiniLabels();
  });
  fromSel.addEventListener('change', updateMiniLabels);
  toSel.addEventListener('change', updateMiniLabels);

  // === REER ===
  const reerYears=[2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2025];
  const reerData={
    USD:[100,101,102,103,104,100,103,107,106,108,107],
    INR:[100,102,105,104,103,101,104,107,108,109,108],
    JPY:[102,101,100,99,98,96,95,92,93,94,95],
    CNY:[104,105,106,107,108,109,110,111,110,109,108],
    HKD:[101,101,102,102,101,100,101,102,101,101,101],
    SGD:[103,104,105,106,107,106,108,110,109,110,111],
    GBP:[101,97,96,95,96,94,95,93,94,95,96],
    CHF:[108,109,110,111,112,113,114,116,115,116,117],
    AUD:[101,100,101,100,99,98,99,97,98,99,100],
    CAD:[100,99,100,101,100,98,99,100,101,102,103]
  };
  const reerColors={
    USD:"#60A5FA", INR:"#22C55E", JPY:"#F97316", CNY:"#FACC15",
    HKD:"#A855F7", SGD:"#2DD4BF", GBP:"#FB7185", CHF:"#6366F1",
    AUD:"#FBBF24", CAD:"#14B8A6"
  };

  function makeReerChart(code){
    const canvas=document.getElementById(`reer-${code}`);
    if(!canvas) return;
    const ctx=canvas.getContext('2d');
    new Chart(ctx,{
      type:'line',
      data:{
        labels:reerYears,
        datasets:[{
          label:`${code} REER index`,
          data:reerData[code],
          borderColor:reerColors[code],
          backgroundColor:'transparent',
          tension:0.3,
          borderWidth:2,
          pointRadius:1.5
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{
          x:{ticks:{color:'#9CA3AF'},grid:{color:'rgba(31,41,55,0.25)'}},
          y:{ticks:{color:'#9CA3AF'},grid:{color:'rgba(31,41,55,0.35)'}}
        }
      }
    });
  }
  ["USD","INR","JPY","CNY","HKD","SGD","GBP","CHF","AUD","CAD"].forEach(makeReerChart);

  // === FLAG QUIZ ===
  const quizFlag = document.getElementById('quizFlag');
  const quizOptionsBox = document.getElementById('quizOptions');
  const quizFeedback = document.getElementById('quizFeedback');
  const quizScoreEl = document.getElementById('quizScore');
  const quizStreakEl = document.getElementById('quizStreak');
  const quizQuestionText = document.getElementById('quizQuestionText');
  const quizProgressFill = document.getElementById('quizProgressFill');

  const QUIZ_MAX_QUESTIONS = 10;
  let quizCorrectCountry = null;
  let totalQuestions = 0;
  let totalCorrect = 0;
  let currentStreak = 0;
  let locked = false;

  function shuffleArray(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()* (i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }
  function pickRandomMeta(){
    const idx = Math.floor(Math.random()*metaArr.length);
    return metaArr[idx];
  }
  function updateQuizScoreUI(){
    quizScoreEl.textContent = `Score: ${totalCorrect} / ${QUIZ_MAX_QUESTIONS}`;
    quizStreakEl.textContent = `Current streak: ${currentStreak}`;
    const currentQ = Math.min(totalQuestions + 1, QUIZ_MAX_QUESTIONS);
    quizQuestionText.textContent = `Question ${currentQ} of ${QUIZ_MAX_QUESTIONS}`;
    const pct = (totalQuestions / QUIZ_MAX_QUESTIONS) * 100;
    quizProgressFill.style.width = `${pct}%`;
  }
  function generateQuizQuestion(){
    if(!quizFlag) return;
    if(totalQuestions >= QUIZ_MAX_QUESTIONS){
      showQuizGameOver();
      return;
    }
    locked = false;
    quizFeedback.textContent='';
    quizFeedback.className='quiz-feedback';

    const q = pickRandomMeta();
    quizCorrectCountry = q.country;
    quizFlag.textContent = q.flag;

    const used = new Set();
    used.add(q.country);
    const options = [q.country];
    while(options.length < 4){
      const cand = pickRandomMeta().country;
      if(!used.has(cand)){
        used.add(cand);
        options.push(cand);
      }
    }
    shuffleArray(options);

    quizOptionsBox.innerHTML='';
    options.forEach(countryName=>{
      const btn = document.createElement('button');
      btn.className='quiz-option';
      btn.textContent = countryName;
      btn.addEventListener('click',()=>handleQuizAnswer(btn,countryName));
      quizOptionsBox.appendChild(btn);
    });

    updateQuizScoreUI();
  }
  function handleQuizAnswer(btn, chosenCountry){
    if(locked) return;
    locked = true;
    totalQuestions++;
    const optionButtons = quizOptionsBox.querySelectorAll('.quiz-option');
    optionButtons.forEach(b=>b.disabled=true);

    if(chosenCountry === quizCorrectCountry){
      totalCorrect++;
      currentStreak++;
      btn.classList.add('correct');
      quizFeedback.textContent='Correct! ‚úÖ';
      quizFeedback.classList.add('correct');
    } else {
      currentStreak = 0;
      btn.classList.add('wrong');
      optionButtons.forEach(b=>{
        if(b.textContent === quizCorrectCountry){
          b.classList.add('correct');
        }
      });
      quizFeedback.textContent=`Wrong ‚ùå ‚Äì Correct: ${quizCorrectCountry}`;
      quizFeedback.classList.add('wrong');
    }
    updateQuizScoreUI();
    if(totalQuestions >= QUIZ_MAX_QUESTIONS){
      setTimeout(showQuizGameOver, 600);
    } else {
      setTimeout(generateQuizQuestion, 900);
    }
  }
  function showQuizGameOver(){
    locked = true;
    quizOptionsBox.innerHTML = '';
    quizFlag.textContent = 'üèÅ';
    quizFeedback.textContent = `Game over ‚Äì You got ${totalCorrect} out of ${QUIZ_MAX_QUESTIONS}.`;
    quizFeedback.className = 'quiz-feedback correct';
    quizQuestionText.textContent = `Finished: ${QUIZ_MAX_QUESTIONS} of ${QUIZ_MAX_QUESTIONS}`;
    quizProgressFill.style.width = '100%';

    const btn = document.createElement('button');
    btn.textContent = 'Play again';
    btn.className = 'quiz-option';
    btn.style.marginTop = '10px';
    btn.addEventListener('click', resetQuizGame);
    quizOptionsBox.appendChild(btn);
  }
  function resetQuizGame(){
    totalQuestions = 0;
    totalCorrect = 0;
    currentStreak = 0;
    updateQuizScoreUI();
    generateQuizQuestion();
  }
  if (quizFlag) {
    updateQuizScoreUI();
    generateQuizQuestion();
  }

  // === BUDGET PLANNER ===
  const bpFromSel = document.getElementById('bpFrom');
  const bpToSel = document.getElementById('bpTo');
  const bpTotalInput = document.getElementById('bpTotal');
  const bpDaysInput = document.getElementById('bpDays');
  const bpTripName = document.getElementById('bpTripName');

  const bpStayPct = document.getElementById('bpStayPct');
  const bpFoodPct = document.getElementById('bpFoodPct');
  const bpTravelPct = document.getElementById('bpTravelPct');
  const bpFunPct = document.getElementById('bpFunPct');

  const bpStayPctLabel = document.getElementById('bpStayPctLabel');
  const bpFoodPctLabel = document.getElementById('bpFoodPctLabel');
  const bpTravelPctLabel = document.getElementById('bpTravelPctLabel');
  const bpFunPctLabel = document.getElementById('bpFunPctLabel');
  const bpPctNote = document.getElementById('bpPctNote');

  const bpCalcBtn = document.getElementById('bpCalcBtn');
  const bpResultBox = document.getElementById('bpResultBox');
  const bpResultMain = document.getElementById('bpResultMain');
  const bpResultSub = document.getElementById('bpResultSub');
  const bpErrorBox = document.getElementById('bpErrorBox');

  const bpSummaryLine = document.getElementById('bpSummaryLine');
  const bpBreakdownList = document.getElementById('bpBreakdownList');

  if (bpFromSel && bpToSel) {
    codes.forEach(code=>{
      const o1=document.createElement('option');
      o1.value=code;
      o1.textContent=labelFor(code);
      bpFromSel.appendChild(o1);

      const o2=document.createElement('option');
      o2.value=code;
      o2.textContent=labelFor(code);
      bpToSel.appendChild(o2);
    });
    if(codes.includes('INR')) bpFromSel.value='INR';
    if(codes.includes('USD')) bpToSel.value='USD';
  }

  function updatePctLabels() {
    const s = Number(bpStayPct?.value || 0);
    const f = Number(bpFoodPct?.value || 0);
    const t = Number(bpTravelPct?.value || 0);
    const u = Number(bpFunPct?.value || 0);
    const total = s + f + t + u;

    if (bpStayPctLabel) bpStayPctLabel.textContent = s + '%';
    if (bpFoodPctLabel) bpFoodPctLabel.textContent = f + '%';
    if (bpTravelPctLabel) bpTravelPctLabel.textContent = t + '%';
    if (bpFunPctLabel) bpFunPctLabel.textContent = u + '%';

    if (bpPctNote) {
      if (total === 100) {
        bpPctNote.textContent = 'Total: 100%. Perfect balance.';
        bpPctNote.style.color = '#9CA3AF';
      } else {
        bpPctNote.textContent = `Total: ${total}%. The planner will scale these proportions to 100%.`;
        bpPctNote.style.color = '#FBBF24';
      }
    }
  }
  if (bpStayPct && bpFoodPct && bpTravelPct && bpFunPct) {
    [bpStayPct, bpFoodPct, bpTravelPct, bpFunPct].forEach(input=>{
      input.addEventListener('input', updatePctLabels);
    });
    updatePctLabels();
  }

  async function calcBudget() {
    if (!bpTotalInput || !bpDaysInput) return;

    bpErrorBox.textContent = '';
    const total = parseFloat(bpTotalInput.value);
    const days = parseInt(bpDaysInput.value, 10);
    const fromCode = bpFromSel.value;
    const toCode = bpToSel.value;
    const tripName = (bpTripName.value || '').trim();

    if (isNaN(total) || total <= 0) {
      bpErrorBox.textContent = 'Enter a valid total amount greater than zero.';
      bpResultBox.classList.remove('show');
      return;
    }
    if (isNaN(days) || days <= 0) {
      bpErrorBox.textContent = 'Enter a valid number of days.';
      bpResultBox.classList.remove('show');
      return;
    }

    let rate, rateSource;
    try {
      const r = await getRateFawazWithFallback(fromCode, toCode);
      rate = r.rate;
      rateSource = r.source;
    } catch (e) {
      console.error(e);
      bpErrorBox.textContent = 'Could not get any rate for this pair.';
      bpResultBox.classList.remove('show');
      return;
    }

    const totalDest = total * rate;
    const perDay = totalDest / days;

    const s = Number(bpStayPct?.value || 0);
    const f = Number(bpFoodPct?.value || 0);
    const t = Number(bpTravelPct?.value || 0);
    const u = Number(bpFunPct?.value || 0);
    let sumPct = s + f + t + u || 1;

    const k = 100 / sumPct;
    const ns = s * k, nf = f * k, nt = t * k, nu = u * k;

    const stayAmt = totalDest * (ns / 100);
    const foodAmt = totalDest * (nf / 100);
    const travelAmt = totalDest * (nt / 100);
    const funAmt = totalDest * (nu / 100);

    const sourceText = rateSource === 'live'
      ? 'using live daily FX (Fawaz API)'
      : 'using offline fallback rates';

    bpResultMain.textContent =
      `${formatNumber(total.toFixed(2))} ${fromCode} ‚âà ${formatNumber(totalDest.toFixed(2))} ${toCode}`;
    bpResultSub.textContent =
      `For ${days} day(s), that is about ${formatNumber(perDay.toFixed(2))} ${toCode} per day ${sourceText}.`;
    bpResultBox.classList.add('show');

    const tripLabel = tripName || 'this trip';
    bpSummaryLine.textContent =
      `You planned ${tripLabel}: ${days} days, total about ${formatNumber(totalDest.toFixed(2))} ${toCode} (` +
      `${formatNumber(perDay.toFixed(2))} ${toCode} per day, ${sourceText}).`;

    if (bpBreakdownList) {
      bpBreakdownList.innerHTML = '';
      const rows = [
        { label: 'Stay', pct: ns, amt: stayAmt, color: '#60A5FA' },
        { label: 'Food', pct: nf, amt: foodAmt, color: '#22C55E' },
        { label: 'Transport', pct: nt, amt: travelAmt, color: '#F97316' },
        { label: 'Fun / Shopping', pct: nu, amt: funAmt, color: '#EC4899' }
      ];
      rows.forEach(r=>{
        const div=document.createElement('div');
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2px;">
            <span>${r.label}</span>
            <span>${r.pct.toFixed(1)}%</span>
          </div>
          <div style="height:6px;border-radius:999px;background:rgba(15,23,42,0.9);overflow:hidden;margin-bottom:2px;">
            <div style="height:100%;width:${r.pct}%;background:${r.color};border-radius:999px;"></div>
          </div>
          <div class="note-small" style="margin-top:0;">
            ‚âà ${formatNumber(r.amt.toFixed(2))} ${toCode} for ${r.label.toLowerCase()}.
          </div>
        `;
        bpBreakdownList.appendChild(div);
      });
    }
  }

  if (bpCalcBtn) {
    bpCalcBtn.addEventListener('click', calcBudget);
  }

  // === QR CODE FOR "OPEN ON MOBILE" ===
  // Generates a QR for the current page URL into #qrCodeBox. [web:159][web:148]
  (function setupQrCode(){
    const box = document.getElementById('qrCodeBox');
    if (!box) return;
    if (typeof QRCode === 'undefined') {
      console.warn('QRCode library not loaded');
      return;
    }
    const url = "https://theycallhimv.github.io/CCV/";
    new QRCode(box, {
      text: url,
      width: 160,
      height: 160,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRCode.CorrectLevel.H
    });
  })();
</script>
